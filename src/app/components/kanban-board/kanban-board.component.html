<!-- Modal overlay for better effect -->
<div class="modal-overlay" *ngIf="showTaskDetails" (click)="closeTacheDetails()"></div>

<div class="app-container">
  <!-- Header -->
  <header class="header">
    <div class="logo">UniGit</div>
    <nav class="nav">
      <span>Projects ‚ñº</span>
      <span>Board</span>
      <span>Levels ‚ñº</span>
    </nav>
    <div class="search">
      <input type="text" placeholder="Search" aria-label="Search tasks" />
      <button aria-label="Search button">üîç</button>
    </div>
    <div class="actions">
      <button aria-label="Settings">‚öôÔ∏è</button>
      <div class="avatar">YT</div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="main">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="project-info">
        <div class="circle">logo</div>
        <h2>ProjectName</h2>
      </div>
      <div class="dropdown">Phases ‚ñº</div>
      <div class="dropdown">Levels ‚ñº</div>
      <div class="dropdown">Teams ‚ñº</div>
      <button class="create-btn">Create ‚ñº</button>
    </aside>

    <!-- Kanban Board -->
    <div class="dashboard-container">
      <div class="board" cdkDropListGroup>
        <div
          *ngFor="let colonne of colonnes"
          cdkDropList
          [id]="colonne.titre"
          [cdkDropListData]="colonne.taches"
          [cdkDropListConnectedTo]="connectedColumns"
          (cdkDropListDropped)="drop($event)"
          class="column"
        >
          <!-- Column Header -->
          <div class="column-header">
            <h2>{{ colonne.titre }}</h2>
            <span class="task-count">{{ colonne.taches.length }}</span>
          </div>

          <!-- Task Cards -->
          <div
            *ngFor="let tache of colonne.taches"
            cdkDrag
            (click)="openTacheDetails(tache, $event)"
            class="task-card"
          >
            <h4>{{ tache.titreTache }}</h4>
            <p class="assigned">Assign√©e √† : {{ tache.assigneA || 'Non assign√©e' }}</p>
            <div class="card-labels">
              <span *ngFor="let label of tache.labels" class="label label-{{label}}"></span>
            </div>
          </div>

          <!-- Add Task Form -->
          <div
            class="add-task-container"
            *ngIf="isAddingTask && newTache.statut === colonne.titre"
          >
            <input
              type="text"
              [(ngModel)]="newTache.titreTache"
              placeholder="Saisir le titre de la t√¢che"
              (keyup.enter)="saveTacheForm()"
              autofocus
              class="add-task-input"
            >
            <div class="add-task-actions">
              <button
                (click)="saveTacheForm()"
                class="add-btn"
                [disabled]="!newTache.titreTache?.trim()"
              >
                Ajouter
              </button>
              <button (click)="resetForm()" class="cancel-btn">Annuler</button>
            </div>
          </div>

          <!-- Add Task Button -->
          <button
            class="add-task-btn"
            (click)="initNewTask(colonne.titre)"
            *ngIf="!isAddingTask || newTache.statut !== colonne.titre"
          >
            + Cr√©er une t√¢che
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Task Detail Popup - Using ng-container to avoid nesting issues -->
  <ng-container *ngIf="showTaskDetails">
    <app-tache
      [tache]="selectedTache"
      (fermer)="closeTacheDetails()"
      (delete)="deleteTache($event)"
      (updateDescription)="updateTacheDescription($event)"
    ></app-tache>
  </ng-container>
</div>
